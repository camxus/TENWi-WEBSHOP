{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"/Users/cam/Desktop/VS CODE/CURRENT TENWI PROJECT/TENWi-WEBSHOP/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/cam/Desktop/VS CODE/CURRENT TENWI PROJECT/TENWi-WEBSHOP/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/cam/Desktop/VS CODE/CURRENT TENWI PROJECT/TENWi-WEBSHOP/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _defineProperty from \"/Users/cam/Desktop/VS CODE/CURRENT TENWI PROJECT/TENWi-WEBSHOP/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useState, useContext, useEffect } from 'react';\nimport { useMutation, useQuery } from '@apollo/client';\nimport YourOrder from \"./YourOrder\";\nimport PaymentModes from \"./PaymentModes\";\nimport { AppContext } from \"../context/AppContext\";\nimport validateAndSanitizeCheckoutForm from '../../validator/checkout';\nimport { getFormattedCart, createCheckoutData } from \"../../functions\";\nimport OrderSuccess from \"./OrderSuccess\";\nimport GET_CART from \"../../queries/get-cart\";\nimport CHECKOUT_MUTATION from \"../../mutations/checkout\";\nimport Address from \"./Address\";\nimport { handleBillingDifferentThanShipping, handleCreateAccount, setStatesForCountry } from \"../../utils/checkout\";\nimport CheckboxField from \"./form-elements/CheckboxField\"; // Use this for testing purposes, so you dont have to fill the checkout form over an over again.\n// const defaultCustomerInfo = {\n// \tfirstName: 'Imran',\n// \tlastName: 'Sayed',\n// \taddress1: '123 Abc farm',\n// \taddress2: 'Hill Road',\n// \tcity: 'Mumbai',\n// \tcountry: 'IN',\n// \tstate: 'Maharastra',\n// \tpostcode: '221029',\n// \temail: 'codeytek.academy@gmail.com',\n// \tphone: '9883778278',\n// \tcompany: 'The Company',\n// \terrors: null\n// }\n\nvar defaultCustomerInfo = {\n  firstName: '',\n  lastName: '',\n  address1: '',\n  address2: '',\n  city: '',\n  country: '',\n  state: '',\n  postcode: '',\n  email: '',\n  phone: '',\n  company: '',\n  errors: null\n};\n\nvar CheckoutForm = function CheckoutForm(_ref) {\n  var countriesData = _ref.countriesData;\n\n  var _ref2 = countriesData || {},\n      billingCountries = _ref2.billingCountries,\n      shippingCountries = _ref2.shippingCountries;\n\n  var initialState = {\n    billing: _objectSpread({}, defaultCustomerInfo),\n    shipping: _objectSpread({}, defaultCustomerInfo),\n    createAccount: false,\n    orderNotes: '',\n    billingDifferentThanShipping: false,\n    paymentMethod: 'cod'\n  };\n\n  var _useContext = useContext(AppContext),\n      cart = _useContext[0],\n      setCart = _useContext[1];\n\n  var _useState = useState(initialState),\n      input = _useState[0],\n      setInput = _useState[1];\n\n  var _useState2 = useState(null),\n      orderData = _useState2[0],\n      setOrderData = _useState2[1];\n\n  var _useState3 = useState(null),\n      requestError = _useState3[0],\n      setRequestError = _useState3[1];\n\n  var _useState4 = useState([]),\n      theShippingStates = _useState4[0],\n      setTheShippingStates = _useState4[1];\n\n  var _useState5 = useState(false),\n      isFetchingShippingStates = _useState5[0],\n      setIsFetchingShippingStates = _useState5[1];\n\n  var _useState6 = useState([]),\n      theBillingStates = _useState6[0],\n      setTheBillingStates = _useState6[1];\n\n  var _useState7 = useState(false),\n      isFetchingBillingStates = _useState7[0],\n      setIsFetchingBillingStates = _useState7[1]; // Get Cart Data.\n\n\n  var _useQuery = useQuery(GET_CART, {\n    notifyOnNetworkStatusChange: true,\n    onCompleted: function onCompleted() {\n      // Update cart in the localStorage.\n      var updatedCart = getFormattedCart(data);\n      localStorage.setItem('tenwi-cart', JSON.stringify(updatedCart)); // Update cart data in React Context.\n\n      setCart(updatedCart);\n    }\n  }),\n      data = _useQuery.data; // Create New order: Checkout Mutation.\n\n\n  var _useMutation = useMutation(CHECKOUT_MUTATION, {\n    variables: {\n      input: orderData\n    },\n    onError: function onError(error) {\n      if (error) {\n        var _error$graphQLErrors$, _error$graphQLErrors, _error$graphQLErrors$2;\n\n        setRequestError((_error$graphQLErrors$ = error === null || error === void 0 ? void 0 : (_error$graphQLErrors = error.graphQLErrors) === null || _error$graphQLErrors === void 0 ? void 0 : (_error$graphQLErrors$2 = _error$graphQLErrors[0]) === null || _error$graphQLErrors$2 === void 0 ? void 0 : _error$graphQLErrors$2.message) !== null && _error$graphQLErrors$ !== void 0 ? _error$graphQLErrors$ : '');\n      }\n    }\n  }),\n      _useMutation2 = _slicedToArray(_useMutation, 2),\n      checkout = _useMutation2[0],\n      _useMutation2$ = _useMutation2[1],\n      checkoutResponse = _useMutation2$.data,\n      checkoutLoading = _useMutation2$.loading;\n  /*\n   * Handle form submit.\n   *\n   * @param {Object} event Event Object.\n   *\n   * @return {void}\n   */\n\n\n  var handleFormSubmit = function handleFormSubmit(event) {\n    event.preventDefault();\n    /**\n     * Validate Billing and Shipping Details\n     *\n     * Note:\n     * 1. If billing is different than shipping address, only then validate billing.\n     * 2. We are passing theBillingStates?.length and theShippingStates?.length, so that\n     * the respective states should only be mandatory, if a country has states.\n     */\n\n    var billingValidationResult = input !== null && input !== void 0 && input.billingDifferentThanShipping ? validateAndSanitizeCheckoutForm(input === null || input === void 0 ? void 0 : input.billing, theBillingStates === null || theBillingStates === void 0 ? void 0 : theBillingStates.length) : {\n      errors: null,\n      isValid: true\n    };\n    var shippingValidationResult = validateAndSanitizeCheckoutForm(input === null || input === void 0 ? void 0 : input.shipping, theShippingStates === null || theShippingStates === void 0 ? void 0 : theShippingStates.length);\n\n    if (!shippingValidationResult.isValid || !billingValidationResult.isValid) {\n      setInput(_objectSpread(_objectSpread({}, input), {}, {\n        billing: _objectSpread(_objectSpread({}, input.billing), {}, {\n          errors: billingValidationResult.errors\n        }),\n        shipping: _objectSpread(_objectSpread({}, input.shipping), {}, {\n          errors: shippingValidationResult.errors\n        })\n      }));\n      return;\n    }\n\n    var checkOutData = createCheckoutData(input);\n    setRequestError(null);\n    /**\n     *  When order data is set, checkout mutation will automatically be called,\n     *  because 'orderData' is added in useEffect as a dependency.\n     */\n\n    setOrderData(checkOutData);\n  };\n  /*\n   * Handle onchange input.\n   *\n   * @param {Object} event Event Object.\n   * @param {bool} isShipping If this is false it means it is billing.\n   * @param {bool} isBillingOrShipping If this is false means its standard input and not billing or shipping.\n   *\n   * @return {void}\n   */\n\n\n  var _handleOnChange = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(event) {\n      var isShipping,\n          isBillingOrShipping,\n          _ref4,\n          target,\n          newState,\n          _args = arguments;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              isShipping = _args.length > 1 && _args[1] !== undefined ? _args[1] : false;\n              isBillingOrShipping = _args.length > 2 && _args[2] !== undefined ? _args[2] : false;\n              _ref4 = event || {}, target = _ref4.target;\n\n              if (!('createAccount' === target.name)) {\n                _context.next = 7;\n                break;\n              }\n\n              handleCreateAccount(input, setInput, target);\n              _context.next = 23;\n              break;\n\n            case 7:\n              if (!('billingDifferentThanShipping' === target.name)) {\n                _context.next = 11;\n                break;\n              }\n\n              handleBillingDifferentThanShipping(input, setInput, target);\n              _context.next = 23;\n              break;\n\n            case 11:\n              if (!isBillingOrShipping) {\n                _context.next = 21;\n                break;\n              }\n\n              if (!isShipping) {\n                _context.next = 17;\n                break;\n              }\n\n              _context.next = 15;\n              return handleShippingChange(target);\n\n            case 15:\n              _context.next = 19;\n              break;\n\n            case 17:\n              _context.next = 19;\n              return handleBillingChange(target);\n\n            case 19:\n              _context.next = 23;\n              break;\n\n            case 21:\n              newState = _objectSpread(_objectSpread({}, input), {}, _defineProperty({}, target.name, target.value));\n              setInput(newState);\n\n            case 23:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleOnChange(_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var handleShippingChange = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(target) {\n      var newState;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              newState = _objectSpread(_objectSpread({}, input), {}, {\n                shipping: _objectSpread(_objectSpread({}, input === null || input === void 0 ? void 0 : input.shipping), {}, _defineProperty({}, target.name, target.value))\n              });\n              setInput(newState);\n              _context2.next = 4;\n              return setStatesForCountry(target, setTheShippingStates, setIsFetchingShippingStates);\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function handleShippingChange(_x2) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  var handleBillingChange = /*#__PURE__*/function () {\n    var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(target) {\n      var newState;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              newState = _objectSpread(_objectSpread({}, input), {}, {\n                billing: _objectSpread(_objectSpread({}, input === null || input === void 0 ? void 0 : input.billing), {}, _defineProperty({}, target.name, target.value))\n              });\n              setInput(newState);\n              _context3.next = 4;\n              return setStatesForCountry(target, setTheBillingStates, setIsFetchingBillingStates);\n\n            case 4:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function handleBillingChange(_x3) {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n\n  useEffect( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            if (!(null !== orderData)) {\n              _context4.next = 3;\n              break;\n            }\n\n            _context4.next = 3;\n            return checkout();\n\n          case 3:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4);\n  })), [orderData]);\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [cart ? /*#__PURE__*/_jsx(\"form\", {\n      onSubmit: handleFormSubmit,\n      className: \"checkout-form\",\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: \"grid grid-cols-1 md:grid-cols-2 gap-20\",\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: \"billing-details\",\n            children: [/*#__PURE__*/_jsx(\"h2\", {\n              className: \"text-xl font-medium mb-4\",\n              children: \"Shipping Details\"\n            }), /*#__PURE__*/_jsx(Address, {\n              states: theShippingStates,\n              countries: shippingCountries,\n              input: input === null || input === void 0 ? void 0 : input.shipping,\n              handleOnChange: function handleOnChange(event) {\n                return _handleOnChange(event, true, true);\n              },\n              isFetchingStates: isFetchingShippingStates,\n              isShipping: true,\n              isBillingOrShipping: true\n            })]\n          }), /*#__PURE__*/_jsx(\"div\", {\n            children: /*#__PURE__*/_jsx(CheckboxField, {\n              name: \"billingDifferentThanShipping\",\n              type: \"checkbox\",\n              checked: input === null || input === void 0 ? void 0 : input.billingDifferentThanShipping,\n              handleOnChange: _handleOnChange,\n              label: \"Billing different than shipping\",\n              containerClassNames: \"mb-4 pt-4\"\n            })\n          }), input !== null && input !== void 0 && input.billingDifferentThanShipping ? /*#__PURE__*/_jsxs(\"div\", {\n            className: \"billing-details\",\n            children: [/*#__PURE__*/_jsx(\"h2\", {\n              className: \"text-xl font-medium mb-4\",\n              children: \"Billing Details\"\n            }), /*#__PURE__*/_jsx(Address, {\n              states: theBillingStates,\n              countries: billingCountries,\n              input: input === null || input === void 0 ? void 0 : input.billing,\n              handleOnChange: function handleOnChange(event) {\n                return _handleOnChange(event, false, true);\n              },\n              isFetchingStates: isFetchingBillingStates,\n              isShipping: false,\n              isBillingOrShipping: true\n            })]\n          }) : null]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"your-orders\",\n          children: [/*#__PURE__*/_jsx(\"h2\", {\n            className: \"text-xl font-medium mb-4\",\n            children: \"Your Order\"\n          }), /*#__PURE__*/_jsx(YourOrder, {\n            cart: cart\n          }), /*#__PURE__*/_jsx(PaymentModes, {\n            input: input,\n            handleOnChange: _handleOnChange\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"place-order-btn-wrap mt-5\",\n            children: /*#__PURE__*/_jsx(\"button\", {\n              className: \"bg-purple-600 text-white px-5 py-3 rounded-sm w-auto xl:w-full\",\n              type: \"submit\",\n              children: \"Place Order\"\n            })\n          }), checkoutLoading && /*#__PURE__*/_jsx(\"p\", {\n            children: \"Processing Order...\"\n          }), requestError && /*#__PURE__*/_jsxs(\"p\", {\n            children: [\"Error : \", requestError, \" :( Please try again\"]\n          })]\n        })]\n      })\n    }) : '', /*#__PURE__*/_jsx(OrderSuccess, {\n      response: checkoutResponse\n    })]\n  });\n};\n\nexport default CheckoutForm;","map":null,"metadata":{},"sourceType":"module"}