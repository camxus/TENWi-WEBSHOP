{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"/Users/cam/Desktop/VS CODE/CURRENT TENWI PROJECT/TENWi-WEBSHOP/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/cam/Desktop/VS CODE/CURRENT TENWI PROJECT/TENWi-WEBSHOP/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/Users/cam/Desktop/VS CODE/CURRENT TENWI PROJECT/TENWi-WEBSHOP/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport { useState, useContext } from \"react\";\nimport { useQuery, useMutation } from '@apollo/client';\nimport Link from \"next/link\";\nimport { v4 } from 'uuid';\nimport cx from 'classnames';\nimport { AppContext } from \"../context/AppContext\";\nimport { getFormattedCart } from \"../../functions\";\nimport GET_CART from \"../../queries/get-cart\";\nimport ADD_TO_CART from \"../../mutations/add-to-cart\";\n\nvar AddToCart = function AddToCart(props) {\n  var _product$externalUrl;\n\n  var product = props.product;\n  var productQryInput = {\n    clientMutationId: v4(),\n    // Generate a unique id.\n    productId: product.productId\n  };\n\n  var _useContext = useContext(AppContext),\n      cart = _useContext[0],\n      setCart = _useContext[1];\n\n  var _useState = useState(false),\n      showViewCart = _useState[0],\n      setShowViewCart = _useState[1];\n\n  var _useState2 = useState(null),\n      requestError = _useState2[0],\n      setRequestError = _useState2[1]; // Get Cart Data.\n\n\n  var _useQuery = useQuery(GET_CART, {\n    notifyOnNetworkStatusChange: true,\n    onCompleted: function onCompleted() {\n      // Update cart in the localStorage.\n      var updatedCart = getFormattedCart(data);\n      localStorage.setItem('tenwi-cart', JSON.stringify(updatedCart)); // Update cart data in React Context.\n\n      setCart(updatedCart);\n    }\n  }),\n      data = _useQuery.data,\n      refetch = _useQuery.refetch; // Add to Cart Mutation.\n\n\n  var _useMutation = useMutation(ADD_TO_CART, {\n    variables: {\n      input: productQryInput\n    },\n    onCompleted: function onCompleted() {\n      // On Success:\n      // 1. Make the GET_CART query to update the cart with new values in React context.\n      refetch(); // 2. Show View Cart Button\n\n      setShowViewCart(true);\n    },\n    onError: function onError(error) {\n      if (error) {\n        var _error$graphQLErrors$, _error$graphQLErrors, _error$graphQLErrors$2;\n\n        setRequestError((_error$graphQLErrors$ = error === null || error === void 0 ? void 0 : (_error$graphQLErrors = error.graphQLErrors) === null || _error$graphQLErrors === void 0 ? void 0 : (_error$graphQLErrors$2 = _error$graphQLErrors[0]) === null || _error$graphQLErrors$2 === void 0 ? void 0 : _error$graphQLErrors$2.message) !== null && _error$graphQLErrors$ !== void 0 ? _error$graphQLErrors$ : '');\n      }\n    }\n  }),\n      _useMutation2 = _slicedToArray(_useMutation, 2),\n      addToCart = _useMutation2[0],\n      _useMutation2$ = _useMutation2[1],\n      addToCartRes = _useMutation2$.data,\n      addToCartLoading = _useMutation2$.loading,\n      addToCartError = _useMutation2$.error;\n\n  var handleAddToCartClick = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setRequestError(null);\n              _context.next = 3;\n              return addToCart();\n\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleAddToCartClick() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    children: [\"ExternalProduct\" === product.__typename ? /*#__PURE__*/_jsx(\"a\", {\n      href: (_product$externalUrl = product === null || product === void 0 ? void 0 : product.externalUrl) !== null && _product$externalUrl !== void 0 ? _product$externalUrl : '/',\n      target: \"_blank\",\n      className: \"px-3 py-1 rounded-sm mr-3 text-sm border-solid border border-current inline-block hover:bg-purple-600 hover:text-white hover:border-purple-600\",\n      children: \"BUY NOW\"\n    }) : /*#__PURE__*/_jsx(\"button\", {\n      disabled: addToCartLoading,\n      onClick: handleAddToCartClick,\n      className: cx('px-3 py-1 rounded-sm mr-3 text-sm border-solid border border-current', {\n        'hover:bg-purple-600 hover:text-white hover:border-purple-600': !addToCartLoading\n      }, {\n        'opacity-50 cursor-not-allowed': addToCartLoading\n      }),\n      children: addToCartLoading ? 'ADDING TO CART...' : 'ADD TO CART'\n    }), showViewCart ? /*#__PURE__*/_jsx(Link, {\n      href: \"/cart\",\n      children: /*#__PURE__*/_jsx(\"button\", {\n        className: \"px-3 py-1 rounded-sm text-sm border-solid border border-current inline-block\",\n        children: \"VIEW CART\"\n      })\n    }) : '']\n  });\n};\n\nexport default AddToCart;","map":null,"metadata":{},"sourceType":"module"}